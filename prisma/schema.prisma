// This file is your Prisma schema, which specifies the database structure.

generator client {
  provider = "prisma-client-js"
}

// CRÍTICO: Asegúrate de que el proveedor sea "postgresql"
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ----------------------------------------------------------------------
// 1. MODELO USER (Simplificado al MÍNIMO para evitar conflicto)
// ----------------------------------------------------------------------

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  password     String
  firstName    String
  role         String 
  
  // Relaciones necesarias
  patients             PatientTherapist[] @relation(name: "TherapistPatients")
  assignedByTherapist  PatientTherapist[] @relation(name: "PatientTherapist")
}

// ----------------------------------------------------------------------
// 2. NUEVO MODELO PATIENTTHERAPIST (La tabla de relaciones)
// ----------------------------------------------------------------------

model PatientTherapist {
  // ID único de la relación
  id           String   @id @default(uuid()) 
  
  // Campo ID del Terapeuta y la relación con el modelo User
  therapistId  String
  therapist    User     @relation(name: "TherapistPatients", fields: [therapistId], references: [id])

  // Campo ID del Paciente y la relación con el modelo User
  patientId    String
  patient      User     @relation(name: "PatientTherapist", fields: [patientId], references: [id])

  // CRÍTICO: Campo de estado para archivar/activar la relación
  isActive     Boolean  @default(true)
  
  // Campos de fecha (opcionales, pero comunes)
  assignedAt   DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // Restricción para evitar duplicados
  @@unique([therapistId, patientId])
}