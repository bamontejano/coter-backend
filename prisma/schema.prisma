// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  // Asegúrate de que esta URL apunta a tu base de datos Neon
  url      = env("DATABASE_URL") 
}

// ----------------------------------------------------
// ENUMS
// ----------------------------------------------------

enum Role {
  THERAPIST
  PATIENT
  ADMIN
}

enum GoalStatus {
  PENDING      // Pendiente de iniciar
  IN_PROGRESS  // En curso
  COMPLETED    // Completada
  ARCHIVED     // Archivado/Cancelada
}

// ----------------------------------------------------
// MODELO USER (CONSOLIDADO)
// ----------------------------------------------------

model User {
  id           String    @id @default(uuid())
  email        String    @unique
  password     String
  role         Role
  firstName    String?
  lastName     String?

  // Relación con Terapeuta (si el usuario es un paciente)
  therapistId  String?
  therapist    User?     @relation("TherapistPatients", fields: [therapistId], references: [id], onDelete: SetNull)

  // Relación con Pacientes (si el usuario es un terapeuta)
  patients     User[]    @relation("TherapistPatients")

  // Metas
  assignedGoals Goal[] @relation("PatientGoals")    // Metas asignadas A este usuario (paciente)
  createdGoals  Goal[] @relation("TherapistGoals")   // Metas creadas POR este usuario (terapeuta)
  
  // Check-ins
  checkins      Checkin[]
  
  // Timestamps
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}


// ----------------------------------------------------
// MODELO GOAL (META)
// ----------------------------------------------------
model Goal {
  id          String     @id @default(uuid())
  title       String
  description String?    // Opcional
  metric      String?    // Campo añadido por el error previo
  target      String?    // ⚠️ CRÍTICO: Campo 'target' añadido para corregir el error actual
  dueDate     DateTime   // Fecha límite
  status      GoalStatus @default(PENDING)

  // Relaciones con User
  patientId   String
  patient     User       @relation("PatientGoals", fields: [patientId], references: [id])

  therapistId String
  therapist   User       @relation("TherapistGoals", fields: [therapistId], references: [id])

  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}


// ----------------------------------------------------
// MODELO CHECKIN
// ----------------------------------------------------
model Checkin {
  id        String    @id @default(uuid())
  moodScore Int?
  notes     String?
  date      DateTime  @default(now())

  // Relación con Paciente
  patientId String
  patient   User      @relation(fields: [patientId], references: [id])
  
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}